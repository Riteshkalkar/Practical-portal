{% extends 'base.html' %}

{% block title %}Select Role - Portal{% endblock %}

{% block content %}
<!-- UI/UX + 3D: 
  - Glassmorphism, gentle gradients, micro-interactions, focus states
  - Accessible: labels, roles, ARIA, keyboard-friendly
  - 3D animated background using Three.js (subtle, GPU-friendly, disabled for prefers-reduced-motion)
  - Smooth reveal on scroll, parallax tilt on cards, ripple on buttons
-->

<!-- Fonts & Icons (if not already included in base.html) -->
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-tfEoV5r2F3eB3zq0oVNe0kGATtGfQyE5t1vFf3qXQ0uJp0lD6CkP6b9gS0d0x0d3v2rZcEoRj3rF8yq3VYQjWg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

<style>
:root {
  --bg-gradient-start: #0f172a;
  --bg-gradient-end: #1e293b;
  --accent-1: #6a11cb;
  --accent-2: #2575fc;
  --glass-light: rgba(255, 255, 255, 0.18);
  --glass-border: rgba(255, 255, 255, 0.25);
  --text-main: #0b1020;
  --text-muted: #64748b;
  --card-bg: #ffffff;
  --shadow-lg: 0 24px 50px rgba(2, 6, 23, 0.15);
  --shadow-md: 0 12px 24px rgba(2, 6, 23, 0.12);
  --radius-xl: 24px;
  --radius-lg: 18px;
}

* { box-sizing: border-box; }
body {
  font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
  color: var(--text-main);
}

/* Page background with 3D canvas layer */
.page-bg {
  position: relative;
  min-height: 100vh;
  overflow: hidden;
  background: linear-gradient(180deg, #f8fafc 0%, #eef1f7 100%);
}

#scene3d {
  position: absolute;
  inset: 0;
  z-index: 0;
  pointer-events: none;
}

/* Container content sits above 3D canvas */
.page-content {
  position: relative;
  z-index: 1;
}

/* HERO SECTION - Glassmorphism */
.hero-box {
  background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
  padding: 72px 40px;
  border-radius: 28px;
  text-align: center;
  color: white;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
  isolation: isolate;
}

.hero-box::after {
  content: "";
  position: absolute;
  top: -20%;
  right: -10%;
  width: 340px;
  height: 340px;
  background: radial-gradient(closest-side, rgba(255,255,255,0.35), transparent);
  filter: blur(12px);
  transform: rotate(15deg);
  z-index: -1;
}

.hero-icon {
  font-size: 64px;
  margin-bottom: 18px;
}

.hero-box .display-5 {
  letter-spacing: -0.02em;
}

.hero-subtitle {
  margin-top: 8px;
  opacity: 0.9;
}

/* Role select */
.role-select-box {
  margin-top: 32px;
}

.form-select-lg {
  border-radius: 16px;
  border: 1px solid var(--glass-border);
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(8px);
  transition: box-shadow 0.25s ease, transform 0.2s ease;
}

.form-select-lg:focus {
  box-shadow: 0 0 0 6px rgba(255,255,255,0.5), var(--shadow-md);
  transform: translateY(-2px);
  outline: none;
}

/* Portals grid */
#portals {
  display: none;
}

.portal-card {
  background: var(--card-bg);
  border-radius: var(--radius-xl);
  padding: 24px;
  text-align: center;
  border: 1px solid #eef2f7;
  box-shadow: var(--shadow-md);
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  will-change: transform;
  transform-style: preserve-3d;
  perspective: 800px;
}

.portal-card:hover {
  transform: translateY(-6px) scale(1.01);
  box-shadow: var(--shadow-lg);
}

.portal-card:focus-within {
  outline: 2px solid rgba(37,117,252,0.25);
}

/* Tilt layers for subtle 3D parallax */
.portal-card .tilt-layer {
  transform: translateZ(24px);
}

.portal-card .tilt-icon {
  transform: translateZ(36px);
}

/* Buttons with ripple */
.btn {
  position: relative;
  overflow: hidden;
}

.btn-ripple::after {
  content: "";
  position: absolute;
  left: 50%;
  top: 50%;
  width: 0;
  height: 0;
  background: rgba(255,255,255,0.4);
  border-radius: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
}

.btn-ripple:active::after {
  width: 220%;
  height: 220%;
  transition: width 0.35s ease, height 0.35s ease;
}

/* Feature cards */
.feature-card {
  background: #ffffff;
  border-radius: var(--radius-lg);
  padding: 28px 22px;
  text-align: left;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
  border: 1px solid #eef2f7;
}

.feature-card:hover {
  transform: translateY(-6px);
  box-shadow: var(--shadow-md);
}

.feature-icon {
  font-size: 40px;
}

/* Reveal animation */
.reveal {
  opacity: 0;
  transform: translateY(14px);
  transition: opacity 600ms ease, transform 600ms ease;
}
.reveal.revealed {
  opacity: 1;
  transform: translateY(0);
}

/* Accessibility: high-contrast focus states */
a.btn:focus, button:focus, .form-select:focus {
  outline: 2px solid #2563eb;
  outline-offset: 2px;
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  .portal-card,
  .feature-card,
  .reveal {
    transition: none !important;
    transform: none !important;
  }
  #scene3d { display: none !important; }
}

/* Utility spacing tweaks */
.section-title {
  letter-spacing: -0.02em;
}
</style>

<div class="page-bg">
  <!-- 3D canvas background -->
  <canvas id="scene3d" aria-hidden="true"></canvas>

  <div class="container py-5 page-content">
    <!-- HERO SECTION -->
    <div class="hero-box mb-5 reveal" role="region" aria-label="Role selection hero">
      <div class="hero-icon">
        <i class="fas fa-users-cog" aria-hidden="true"></i>
      </div>
      <h1 class="display-5 fw-bold">Select your role</h1>
      <p class="lead hero-subtitle">Choose your role to continue</p>

      <!-- Role Dropdown -->
      <div class="col-12 col-md-6 mx-auto role-select-box">
        <label for="roleSelector" class="visually-hidden">Select your role</label>
        <select class="form-select form-select-lg shadow-sm" id="roleSelector" aria-label="Select your role">
          <option value="">-- Select Role --</option>
          <option value="student">Student</option>
          <option value="teacher">Teacher</option>
          <option value="examiner">Examiner</option>
          <option value="hod">HOD</option>
          <option value="admin">Admin</option>
        </select>
      </div>
    </div>

    <!-- Portals Section -->
    <div id="portals" class="row justify-content-center g-4 mt-2" aria-live="polite" aria-label="Portals list">
      <!-- Student -->
      <div class="col-12 col-md-4 reveal" data-role="student">
        <div class="card h-100 border-0 shadow-lg rounded-4 portal-card p-4 text-center" tabindex="0">
          <div class="tilt-icon mb-3">
            <i class="fas fa-user-graduate fa-3x text-primary" aria-hidden="true"></i>
          </div>
          <div class="tilt-layer">
            <h5 class="fw-bold">Student portal</h5>
            <p class="small text-muted">Submit practicals & track progress</p>
            <div class="d-flex gap-2 justify-content-center mt-2">
              <a href="{% url 'student_login' %}" class="btn btn-primary btn-lg btn-ripple">Login</a>
              <a href="{% url 'student_register' %}" class="btn btn-primary btn-lg btn-ripple">Register</a>

            </div>
          </div>
        </div>
      </div>

      <!-- Teacher -->
      <div class="col-12 col-md-4 reveal" data-role="teacher">
        <div class="card h-100 border-0 shadow-lg rounded-4 portal-card p-4 text-center" tabindex="0">
          <div class="tilt-icon mb-3">
            <i class="fas fa-chalkboard-teacher fa-3x text-success" aria-hidden="true"></i>
          </div>
          <div class="tilt-layer">
            <h5 class="fw-bold">Teacher portal</h5>
            <p class="small text-muted">Review submissions & manage practicals</p>
            <div class="d-flex gap-2 justify-content-center mt-2">
              <a href="{% url 'teacher_login' %}" class="btn btn-success btn-lg btn-ripple">Login</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Examiner -->
      <div class="col-12 col-md-4 reveal" data-role="examiner">
        <div class="card h-100 border-0 shadow-lg rounded-4 portal-card p-4 text-center" tabindex="0">
          <div class="tilt-icon mb-3">
            <i class="fas fa-user-check fa-3x text-info" aria-hidden="true"></i>
          </div>
          <div class="tilt-layer">
            <h5 class="fw-bold">Examiner portal</h5>
            <p class="small text-muted">Verify submissions & certificates</p>
            <a href="{% url 'examiner_login' %}" class="btn btn-info btn-lg text-white btn-ripple mt-2">Login</a>
          </div>
        </div>
      </div>

      <!-- HOD -->
      <div class="col-12 col-md-4 reveal" data-role="hod">
        <div class="card h-100 border-0 shadow-lg rounded-4 portal-card p-4 text-center" tabindex="0">
          <div class="tilt-icon mb-3">
            <i class="fas fa-user-tie fa-3x text-warning" aria-hidden="true"></i>
          </div>
          <div class="tilt-layer">
            <h5 class="fw-bold">HOD portal</h5>
            <p class="small text-muted">Manage departments & subjects</p>
            <div class="d-flex gap-2 justify-content-center mt-2">
              <a href="{% url 'hod_login' %}" class="btn btn-warning btn-lg btn-ripple">Login</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Admin -->
      <div class="col-12 col-md-4 reveal" data-role="admin">
        <div class="card h-100 border-0 shadow-lg rounded-4 portal-card p-4 text-center" tabindex="0">
          <div class="tilt-icon mb-3">
            <i class="fas fa-user-shield fa-3x text-danger" aria-hidden="true"></i>
          </div>
          <div class="tilt-layer">
            <h5 class="fw-bold">Admin portal</h5>
            <p class="small text-muted">Full system control</p>
            <a href="{% url 'admin_login' %}" class="btn btn-danger btn-lg btn-ripple mt-2">Login</a>
          </div>
        </div>
      </div>
    </div>

    <!-- FEATURES -->
   <h2 class="text-center fw-bold mb-4 mt-5 section-title">Portal features</h2>
<div class="row g-4">
  <!-- STUDENT -->
  <div class="col-md-4 reveal">
    <div class="feature-card">
      <div class="feature-icon text-primary"><i class="fas fa-user-graduate" aria-hidden="true"></i></div>
      <h5 class="fw-bold">Student Portal</h5>
      <p class="text-muted mt-2">
        - Submit practicals online.<br>
        - Track your progress and grades.<br>
        - Download certificates and feedback.
      </p>
    </div>
  </div>

  <!-- TEACHER -->
  <div class="col-md-4 reveal">
    <div class="feature-card">
      <div class="feature-icon text-success"><i class="fas fa-chalkboard-teacher" aria-hidden="true"></i></div>
      <h5 class="fw-bold">Teacher Portal</h5>
      <p class="text-muted mt-2">
        - Review student submissions.<br>
        - Provide feedback and corrections.<br>
        - Manage practical assignments and schedules.
      </p>
    </div>
  </div>

  <!-- EXAMINER -->
  <div class="col-md-4 reveal">
    <div class="feature-card">
      <div class="feature-icon text-info"><i class="fas fa-user-check" aria-hidden="true"></i></div>
      <h5 class="fw-bold">Examiner Portal</h5>
      <p class="text-muted mt-2">
        - Verify submissions and certificates.<br>
        - Approve student certtificates.<br>
        
      </p>
    </div>
  </div>

  <!-- HOD -->
  <div class="col-md-4 reveal">
    <div class="feature-card">
      <div class="feature-icon text-warning"><i class="fas fa-user-tie" aria-hidden="true"></i></div>
      <h5 class="fw-bold">HOD Portal</h5>
      <p class="text-muted mt-2">
        - Manage department and subjects.<br>
        - Assign teachers and exams.<br>
        - Oversee student progress .
      </p>
    </div>
  </div>

  <!-- ADMIN -->
  <div class="col-md-4 reveal">
    <div class="feature-card">
      <div class="feature-icon text-danger"><i class="fas fa-user-shield" aria-hidden="true"></i></div>
      <h5 class="fw-bold">Admin Portal</h5>
      <p class="text-muted mt-2">
        - Full system control.<br>
        - Manage users, roles, and permissions.<br>
        - Audit activity logs and maintain system settings.
      </p>
    </div>
  </div>
</div>

  </div>
</div>

<!-- Three.js (3D background) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js" integrity="sha512-8f6oKJbUj7M3bQd8g2ZfCwHkUqgqO0H/5wq5U5r2n8t3Jv4uFQfC0Psh4pKXkzZf2QmA7L5kV2bT5Wn0wC1oGg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
/* Role filtering + accessibility */
function showPortal() {
  const role = document.getElementById("roleSelector").value;
  const allCards = document.querySelectorAll("[data-role]");
  const portalBox = document.getElementById("portals");

  if (!role) {
    portalBox.style.display = "none";
    return;
  }
  portalBox.style.display = "flex";

  allCards.forEach(card => {
    const match = card.getAttribute("data-role") === role;
    card.style.display = match ? "block" : "none";
    card.setAttribute('aria-hidden', match ? 'false' : 'true');
  });
}

/* Initialize role selector */
document.getElementById("roleSelector").addEventListener("change", showPortal);

/* Reveal on scroll */
const revealEls = document.querySelectorAll('.reveal');
const io = new IntersectionObserver(entries => {
  entries.forEach(entry => {
    if (entry.isIntersecting) entry.target.classList.add('revealed');
  });
}, { threshold: 0.12 });
revealEls.forEach(el => io.observe(el));

/* Card tilt interaction (parallax 3D) */
document.querySelectorAll('.portal-card').forEach(card => {
  const rect = () => card.getBoundingClientRect();
  const maxTilt = 8; // degrees
  card.addEventListener('mousemove', (e) => {
    const r = rect();
    const cx = e.clientX - r.left;
    const cy = e.clientY - r.top;
    const rx = ((cy / r.height) - 0.5) * -2 * maxTilt;
    const ry = ((cx / r.width) - 0.5) * 2 * maxTilt;
    card.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg) translateY(-6px) scale(1.01)`;
  });
  card.addEventListener('mouseleave', () => {
    card.style.transform = '';
  });
});

/* Button ripple effect */
document.querySelectorAll('.btn-ripple').forEach(btn => {
  btn.addEventListener('click', (e) => {
    const rect = btn.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const ripple = document.createElement('span');
    ripple.style.position = 'absolute';
    ripple.style.left = `${x}px`;
    ripple.style.top = `${y}px`;
    ripple.style.width = ripple.style.height = '0px';
    ripple.style.background = 'rgba(255,255,255,0.35)';
    ripple.style.borderRadius = '50%';
    ripple.style.transform = 'translate(-50%, -50%)';
    ripple.style.pointerEvents = 'none';
    ripple.style.transition = 'width 0.45s ease, height 0.45s ease, opacity 0.6s ease';
    btn.appendChild(ripple);
    requestAnimationFrame(() => {
      ripple.style.width = ripple.style.height = '260px';
      ripple.style.opacity = '0';
    });
    setTimeout(() => ripple.remove(), 650);
  });
});

/* Keyboard navigation for cards */
document.querySelectorAll('.portal-card').forEach(card => {
  card.addEventListener('keydown', (e) => {
    if (e.key === 'Enter') {
      const primary = card.querySelector('a.btn');
      if (primary) primary.click();
    }
  });
});

/* 3D animated background - soft floating orb with gradient */
(function init3D() {
  const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
  const canvas = document.getElementById('scene3d');
  if (!canvas || prefersReduced) return;

  const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

  const scene = new THREE.Scene();
  const camera = new THREE.PerspectiveCamera(50, 1, 0.1, 100);
  camera.position.z = 6;

  const resize = () => {
    const w = canvas.clientWidth || window.innerWidth;
    const h = canvas.clientHeight || window.innerHeight;
    canvas.width = w; canvas.height = h;
    renderer.setSize(w, h, false);
    camera.aspect = w / h;
    camera.updateProjectionMatrix();
  };
  window.addEventListener('resize', resize);
  resize();

  // Gradient environment light
  const hemiLight = new THREE.HemisphereLight(0x88ccff, 0xff88aa, 0.8);
  scene.add(hemiLight);
  const dirLight = new THREE.DirectionalLight(0xffffff, 0.25);
  dirLight.position.set(3, 4, 5);
  scene.add(dirLight);

  // A subtle glassy sphere
  const sphereGeo = new THREE.SphereGeometry(2.4, 64, 64);
  const sphereMat = new THREE.MeshPhysicalMaterial({
    color: 0x6a11cb,
    emissive: 0x000000,
    metalness: 0.35,
    roughness: 0.2,
    transmission: 0.75,   // glass-like
    thickness: 0.6,
    clearcoat: 0.8,
    clearcoatRoughness: 0.15,
  });
  const sphere = new THREE.Mesh(sphereGeo, sphereMat);
  sphere.position.set(0, -0.2, 0);
  scene.add(sphere);

  // Floating particles ring
  const pCount = 120;
  const pGeo = new THREE.BufferGeometry();
  const positions = new Float32Array(pCount * 3);
  for (let i = 0; i < pCount; i++) {
    const angle = (i / pCount) * Math.PI * 2;
    const radius = 4 + Math.sin(i) * 0.35;
    positions[i*3] = Math.cos(angle) * radius;
    positions[i*3+1] = Math.sin(angle * 1.5) * 0.6;
    positions[i*3+2] = Math.sin(angle) * radius * 0.2;
  }
  pGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
  const pMat = new THREE.PointsMaterial({
    color: 0x2575fc,
    size: 0.04,
    transparent: true,
    opacity: 0.7
  });
  const points = new THREE.Points(pGeo, pMat);
  scene.add(points);

  // Cursor parallax
  const mouse = { x: 0, y: 0 };
  window.addEventListener('mousemove', (e) => {
    const x = (e.clientX / window.innerWidth) * 2 - 1;
    const y = (e.clientY / window.innerHeight) * 2 - 1;
    mouse.x = x; mouse.y = y;
  });

  let t = 0;
  function animate() {
    t += 0.005;
    sphere.rotation.y += 0.003;
    sphere.rotation.x = Math.sin(t) * 0.08;
    sphere.position.y = Math.sin(t * 0.8) * 0.12;

    points.rotation.y += 0.0015;
    points.rotation.x = Math.sin(t * 0.6) * 0.02;

    camera.position.x = mouse.x * 0.25;
    camera.position.y = -mouse.y * 0.15;
    camera.lookAt(new THREE.Vector3(0, 0, 0));

    renderer.render(scene, camera);
    requestAnimationFrame(animate);
  }
  animate();
})();
</script>
{% endblock %}
